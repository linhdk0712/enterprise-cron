@startuml Job Management Use Cases - Detailed

title Job Management - Detailed Use Cases

actor "System Administrator" as Admin
actor "Scheduler Process" as Scheduler

rectangle "Job Management Subsystem" {
  
  usecase "Create Job" as UC1 {
    --
    **Primary Flow:**
    1. Admin provides job details
    2. System validates input
    3. System validates schedule
    4. System stores job in database
    5. System returns job ID
    --
    **Validates:**
    Requirements 1.1-1.7, 12.6
  }
  
  usecase "Configure Cron Schedule" as UC1_1 {
    --
    Parse Quartz-syntax cron
    with second precision
    --
    **Validates:** Req 1.1
  }
  
  usecase "Configure Fixed Delay" as UC1_2 {
    --
    Schedule next execution
    X seconds after completion
    --
    **Validates:** Req 1.4
  }
  
  usecase "Configure Fixed Rate" as UC1_3 {
    --
    Schedule at fixed intervals
    regardless of duration
    --
    **Validates:** Req 1.5
  }
  
  usecase "Configure One-Time Job" as UC1_4 {
    --
    Execute once at specific
    datetime and mark complete
    --
    **Validates:** Req 1.6
  }
  
  usecase "Set Timezone" as UC1_5 {
    --
    Default: Asia/Ho_Chi_Minh
    Support chrono_tz timezones
    --
    **Validates:** Req 1.2, 1.3
  }
  
  usecase "Set End Date" as UC1_6 {
    --
    Stop scheduling after
    end date is reached
    --
    **Validates:** Req 1.7
  }
  
  usecase "Update Job" as UC2 {
    --
    **Primary Flow:**
    1. Admin provides job ID and updates
    2. System validates changes
    3. System updates database
    4. Changes apply to future executions
    5. No restart required
    --
    **Validates:** Req 7.3
  }
  
  usecase "Delete Job" as UC3 {
    --
    **Primary Flow:**
    1. Admin provides job ID
    2. System checks permissions
    3. System removes from database
    4. Scheduler stops scheduling
    5. No restart required
    --
    **Validates:** Req 7.4
  }
  
  usecase "Enable Job" as UC4_1 {
    --
    Resume scheduling executions
    from current time
    --
    **Validates:** Req 6.6
  }
  
  usecase "Disable Job" as UC4_2 {
    --
    Stop scheduling future
    executions immediately
    --
    **Validates:** Req 6.5
  }
  
  usecase "View Job List" as UC5 {
    --
    **Display:**
    - Current status
    - Next run time
    - Last run time
    - Success rate
    --
    **Validates:** Req 6.1
  }
  
  usecase "Trigger Job Manually" as UC6 {
    --
    **Primary Flow:**
    1. Admin selects job
    2. System checks execute permission
    3. System creates execution
    4. System queues job immediately
    --
    **Validates:** Req 6.4
  }
  
  usecase "Detect Jobs Due" as UC7 {
    --
    **Scheduler Flow:**
    1. Poll database every N seconds
    2. Calculate next execution time
    3. Compare with current time
    4. Return jobs that are due
    --
    **Validates:** Req 1.1-1.7
  }
  
  usecase "Validate JWT Token" as UC_Auth
  usecase "Check RBAC Permissions" as UC_RBAC
  usecase "Store in System Database" as UC_DB
}

' Admin relationships
Admin --> UC1
Admin --> UC2
Admin --> UC3
Admin --> UC4_1
Admin --> UC4_2
Admin --> UC5
Admin --> UC6

' Scheduler relationships
Scheduler --> UC7

' Include/Extend relationships
UC1 ..> UC1_1 : <<extend>>
UC1 ..> UC1_2 : <<extend>>
UC1 ..> UC1_3 : <<extend>>
UC1 ..> UC1_4 : <<extend>>
UC1 ..> UC1_5 : <<include>>
UC1 ..> UC1_6 : <<extend>>
UC1 ..> UC_Auth : <<include>>
UC1 ..> UC_RBAC : <<include>>
UC1 ..> UC_DB : <<include>>

UC2 ..> UC_Auth : <<include>>
UC2 ..> UC_RBAC : <<include>>
UC2 ..> UC_DB : <<include>>

UC3 ..> UC_Auth : <<include>>
UC3 ..> UC_RBAC : <<include>>
UC3 ..> UC_DB : <<include>>

UC6 ..> UC_Auth : <<include>>
UC6 ..> UC_RBAC : <<include>>

UC7 ..> UC_DB : <<include>>

' Notes
note right of UC1
  **Schedule Types:**
  - Cron (Quartz syntax)
  - Fixed Delay
  - Fixed Rate
  - One-Time
  
  **Job Types:**
  - HTTP Request
  - Database Query
end note

note right of UC7
  Scheduler polls database
  at configurable interval
  (default: 10 seconds)
  
  Uses distributed lock to
  prevent duplicate scheduling
end note

note bottom of UC_RBAC
  **Required Permissions:**
  - job:read (view)
  - job:write (create/update)
  - job:execute (trigger)
  - job:delete (delete)
end note

@enduml
